[
  {
    "Id": "987336",
    "ThreadId": "429726",
    "Html": "\r\n<p>I'm really new to C# and i have found this API to be really helpful. I have the following code to listen to the wifi connect/disconnect events.</p>\r\n<p>&nbsp;</p>\r\n<p></p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> wlanConnectionChangeHandler(Wlan.WlanNotificationData notifyData, Wlan.WlanConnectionNotificationData connNotifyData){\r\n            <span style=\"color:blue\">string</span> msg = String.Empty;\r\n\r\n            <span style=\"color:blue\">switch</span> (notifyData.notificationSource)\r\n            {\r\n                <span style=\"color:blue\">case</span> Wlan.WlanNotificationSource.ACM:\r\n\r\n                    <span style=\"color:blue\">switch</span> ((Wlan.WlanNotificationCodeAcm)notifyData.notificationCode)\r\n                    {\r\n                        <span style=\"color:blue\">case</span> Wlan.WlanNotificationCodeAcm.ConnectionStart:\r\n                            msg = <span style=\"color:#a31515\">&quot;ConnectionStart&quot;</span>;\r\n                            <span style=\"color:blue\">break</span>;\r\n\r\n                        <span style=\"color:blue\">case</span> Wlan.WlanNotificationCodeAcm.ConnectionComplete:\r\n                                msg = <span style=\"color:#a31515\">&quot;ConnectionComplete&quot;</span>;\r\n                                WlanClient client = <span style=\"color:blue\">new</span> WlanClient();\r\n                                <span style=\"color:blue\">foreach</span> (WlanClient.WlanInterface wlanIface <span style=\"color:blue\">in</span> client.Interfaces)\r\n                                {\r\n                                    Wlan.WlanAssociationAttributes conAttributes = wlanIface.CurrentConnection.wlanAssociationAttributes;\r\n                                    Wlan.Dot11Ssid ssid = conAttributes.dot11Ssid;\r\n                                    PhysicalAddress bssid = conAttributes.Dot11Bssid;\r\n                                    <span style=\"color:blue\">int</span> rssi = wlanIface.RSSI;\r\n\r\n                                    msg &#43;= <span style=\"color:#a31515\">&quot;. ssid: &quot;</span> &#43; GetStringForSSID(ssid) &#43; <span style=\"color:#a31515\">&quot;. rssi: &quot;</span> &#43; rssi.ToString() &#43; <span style=\"color:#a31515\">&quot;. MAC: &quot;</span> &#43; bssid.ToString();\r\n                                    <span style=\"color:blue\">break</span>;\r\n                                }\r\n\r\n                            <span style=\"color:blue\">break</span>;\r\n\r\n                        <span style=\"color:blue\">case</span> Wlan.WlanNotificationCodeAcm.Disconnecting:\r\n                            msg = <span style=\"color:#a31515\">&quot;Disconnecting&quot;</span>;\r\n                            <span style=\"color:blue\">break</span>;\r\n\r\n                        <span style=\"color:blue\">case</span> Wlan.WlanNotificationCodeAcm.Disconnected:\r\n                            msg = <span style=\"color:#a31515\">&quot;Disconnected&quot;</span>;\r\n                            <span style=\"color:blue\">break</span>;\r\n\r\n                        <span style=\"color:blue\">default</span>:\r\n                            msg = <span style=\"color:#a31515\">&quot;unknown notificationCode =&quot;</span> &#43; notifyData.notificationCode;\r\n                            <span style=\"color:blue\">break</span>;\r\n\r\n                    }\r\n                    MessageBox.Show(msg &#43; <span style=\"color:#a31515\">&quot; for profile:&quot;</span> &#43; connNotifyData.profileName);\r\n                    <span style=\"color:blue\">break</span>;\r\n\r\n                <span style=\"color:blue\">default</span>:\r\n                    <span style=\"color:green\">//MessageBox.Show(&quot;irrelevant notification. Ignore&quot;);</span>\r\n                    <span style=\"color:blue\">break</span>;\r\n            }\r\n        }\r\n\r\n        <span style=\"color:blue\">static</span> <span style=\"color:blue\">string</span> GetStringForSSID(Wlan.Dot11Ssid ssid)\r\n        {\r\n            <span style=\"color:blue\">return</span> Encoding.ASCII.GetString( ssid.SSID, 0, (<span style=\"color:blue\">int</span>) ssid.SSIDLength );\r\n        }\r\n\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> registerWlanListener()\r\n        {\r\n            WlanClient client = <span style=\"color:blue\">new</span> WlanClient();\r\n\r\n            <span style=\"color:blue\">foreach</span> (WlanClient.WlanInterface wlanIface <span style=\"color:blue\">in</span> client.Interfaces)\r\n            {\r\n                <span style=\"color:blue\">string</span> str = <span style=\"color:#a31515\">&quot;Name=&quot;</span> &#43; wlanIface.InterfaceName &#43; <span style=\"color:#a31515\">&quot;. State: &quot;</span>;\r\n\r\n                <span style=\"color:blue\">switch</span> (wlanIface.InterfaceState)\r\n                {\r\n                    <span style=\"color:blue\">case</span> Wlan.WlanInterfaceState.NotReady:\r\n                        str &#43;= <span style=\"color:#a31515\">&quot;NotReady&quot;</span>;\r\n                        <span style=\"color:blue\">break</span>;\r\n\r\n                    <span style=\"color:blue\">case</span> Wlan.WlanInterfaceState.Disconnected:\r\n                        str &#43;= <span style=\"color:#a31515\">&quot;Disconnected&quot;</span>;\r\n                        <span style=\"color:blue\">break</span>;\r\n\r\n                    <span style=\"color:blue\">case</span> Wlan.WlanInterfaceState.Disconnecting:\r\n                        str &#43;= <span style=\"color:#a31515\">&quot;Disconnecting&quot;</span>;\r\n                        <span style=\"color:blue\">break</span>;\r\n\r\n                    <span style=\"color:blue\">case</span> Wlan.WlanInterfaceState.Connected:\r\n                        str &#43;= <span style=\"color:#a31515\">&quot;Connected&quot;</span>;\r\n                        <span style=\"color:blue\">break</span>;\r\n                }\r\n\r\n                wlanIface.WlanConnectionNotification &#43;= wlanConnectionChangeHandler;\r\n                MessageBox.Show(str &#43; <span style=\"color:#a31515\">&quot;. Listener registered&quot;</span>);\r\n            }\r\n        }\r\n\r\n        <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> unregisterWlanListener()\r\n        {\r\n            WlanClient client = <span style=\"color:blue\">new</span> WlanClient();\r\n\r\n            <span style=\"color:blue\">foreach</span> (WlanClient.WlanInterface wlanIface <span style=\"color:blue\">in</span> client.Interfaces)\r\n            {\r\n                wlanIface.WlanConnectionNotification -= wlanConnectionChangeHandler;\r\n                MessageBox.Show(wlanIface.InterfaceName &#43; <span style=\"color:#a31515\">&quot;. Listener unregistered&quot;</span>);\r\n            }\r\n        }\r\n\r\n</pre>\r\n</div>\r\n<p></p>\r\n<p>At the start, i call registerWlanListener, and before stopping my app, i call unregisterWlanListener(). I've tested my desktop app on win7 as well as win8 tablet, and have the following issues on both:</p>\r\n<p>1. Most of the time, my wlanConnectionChangeHandler gets called on the wifi connect/disconnect and everything works fine. However, on some occasion, it doesn't get called at all. What can lead to this?</p>\r\n<p>2. On separate occasions, even though I've removed the event handler, i've still received notifications. Am I missing something in removing these event handler?</p>\r\n<p>Thank you.</p>\r\n",
    "PostedDate": "2013-01-15T15:47:00.863-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "987337",
    "ThreadId": "429726",
    "Html": "\r\n<p>just a quick note that i tested this by connecting/disconnecting the wifi connection many times and try to observe the notification. I notice that after the initial missed notification, i can't receive any further notification at all even if i continue to\r\n connect/disconnect the wifi connection. It's confusing because this code does work most of the time.</p>\r\n",
    "PostedDate": "2013-01-15T15:58:00.107-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "987664",
    "ThreadId": "429726",
    "Html": "\r\n<p>Obviously i wasn't thinking clearly when i was coding this. The issue is the local scope of my WlanClient client. Fixed it by making it a global var and only instantiate it once. /facepalm</p>\r\n",
    "PostedDate": "2013-01-16T08:59:44.793-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]